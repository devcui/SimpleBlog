<!doctype html><html lang=cn dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>微前端 | 神奇宝贝大师的旅行日记</title><meta name=keywords content><meta name=description content="神奇宝贝大师的传奇之旅"><meta name=author content="cui"><link rel=canonical href=https://devcui.github.io/pokemon/categories/%E5%BE%AE%E5%89%8D%E7%AB%AF/><meta name=google-site-verification content="blog"><meta name=yandex-verification content="blog"><meta name=msvalidate.01 content="blog"><link crossorigin=anonymous href=/pokemon/assets/css/stylesheet.2068759a50238aee83375bc8cb602a1caff7316bea9cc81b83d90aeea0e276c5.css integrity="sha256-IGh1mlAjiu6DN1vIy2AqHK/3MWvqnMgbg9kK7qDidsU=" rel="preload stylesheet" as=style><link rel=icon href=https://devcui.github.io/pokemon/images/favicon.png><link rel=icon type=image/png sizes=16x16 href=https://devcui.github.io/pokemon/images/favicon.png><link rel=icon type=image/png sizes=32x32 href=https://devcui.github.io/pokemon/images/favicon.png><link rel=apple-touch-icon href=https://devcui.github.io/pokemon/images/favicon.png><link rel=mask-icon href=https://devcui.github.io/pokemon/images/favicon.png><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate type=application/rss+xml href=https://devcui.github.io/pokemon/categories/%E5%BE%AE%E5%89%8D%E7%AB%AF/index.xml><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script type=application/javascript>var doNotTrack=!1;doNotTrack||(function(e,t,n,s,o,i,a){e.GoogleAnalyticsObject=o,e[o]=e[o]||function(){(e[o].q=e[o].q||[]).push(arguments)},e[o].l=1*new Date,i=t.createElement(n),a=t.getElementsByTagName(n)[0],i.async=1,i.src=s,a.parentNode.insertBefore(i,a)}(window,document,"script","https://www.google-analytics.com/analytics.js","ga"),ga("create","UA-213464061-1","auto"),ga("send","pageview"))</script><meta property="og:title" content="微前端"><meta property="og:description" content="神奇宝贝大师的传奇之旅"><meta property="og:type" content="website"><meta property="og:url" content="https://devcui.github.io/pokemon/categories/%E5%BE%AE%E5%89%8D%E7%AB%AF/"><meta property="og:image" content="https://devcui.github.io/pokemon/images/head.png"><meta property="og:site_name" content="神奇宝贝大师的旅行日记"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://devcui.github.io/pokemon/images/head.png"><meta name=twitter:title content="微前端"><meta name=twitter:description content="神奇宝贝大师的传奇之旅"></head><body class=list id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://devcui.github.io/pokemon/ accesskey=h title="  (Alt + H)"><img src=https://devcui.github.io/pokemon/images/favicon.png alt aria-label=logo height=35></a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://devcui.github.io/pokemon/posts title=列表><span>列表</span></a></li><li><a href=https://devcui.github.io/pokemon/categories title=分类><span>分类</span></a></li><li><a href=https://devcui.github.io/pokemon/tags title=标签><span>标签</span></a></li><li><a href=https://devcui.github.io/pokemon/series title=系列><span>系列</span></a></li><li><a href=https://devcui.github.io/pokemon/archives title=归档><span>归档</span></a></li><li><a href=https://devcui.github.io/pokemon/about title=关于><span>关于</span></a></li><li><a href=https://devcui.github.io/pokemon/sponsor title=赞助><span>赞助</span></a></li><li><a href=https://zukan.pokemon.co.jp/ title=图鉴><span>图鉴</span>&nbsp;<svg fill="none" shape-rendering="geometricPrecision" stroke="currentcolor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" viewBox="0 0 24 24" height="12" width="12"><path d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6"/><path d="M15 3h6v6"/><path d="M10 14 21 3"/></svg></a></li></ul></nav></header><main class=main><header class=page-header><div class=breadcrumbs><a href=https://devcui.github.io/pokemon/>Home</a>&nbsp;»&nbsp;<a href=https://devcui.github.io/pokemon/categories/>Categories</a></div><h1>微前端</h1></header><article class="post-entry tag-entry"><header class=entry-header><h2>关于微前端实现原理与ngx-planet(一)</h2></header><div class=entry-content><p>微前端? 简单来说
从使用角度考虑 D应用是由 ABC三个应用/组件组合而成，通常在Angular/Vue/React单项目中很容易实现，但为了复用解耦，D应用现由3个独立部署并带有通信机制的应用/组件组合而成。 从部署角度考虑 A,B,C,D为并行四个打包后的静态文件，当有E应用使用A,B,C,D应用中的组件或者事件时通过类eureka 服务发现注册的方式去复用组件或应用。
当然，这只是众多思路中的一种 当然，这只是众多思路中的一种 当然，这只是众多思路中的一种
好处:
应用自治: 只需要遵循统一的接口规范或者框架，以便于系统集成到一起，相互之间是不存在依赖关系的。
单一职责: 每个前端应用可以只关注于自己所需要完成的功能。
技术栈无关: 你可以使用 Angular 的同时，又可以使用 React 和 Vue。
这就好像使用k8s集群和grpc调用一样
架构模式 基座模式: 通常有一个main/portal应用来充当基座，提供基础服务，剩下的应用可插拔在基座上。好像dashboard和widget的关系 自组织模式: 各个应用平级不存在相互管理 实现思路 基于基座模式的微服务无非是 服务发现,服务注册,服务调用等功能
基座应用: 主要应有注册表，通过各个应用标识存储key:component|application 以应对路由不通渲染哪个应用 工程逻辑/应用管理/加载: 先看成一个黑盒 路由分发: 通过对url规则和分析出渲染哪个应用/组件，经过黑盒渲染到需要渲染的dom上 难点 Load，决定加载哪个应用，并绑定生命周期 bootstrap，获取静态资源 Mount，安装应用，如创建 DOM 节点 Unload，删除应用的生命周期 Unmount，卸载应用，如删除 DOM 节点、取消事件绑定 单个浏览器多个应用还需做到 状态|css 共享/隔离
技术方式 从技术实践上，微前端架构可以采用以下的几种方式进行：
路由分发式。通过 HTTP 服务器的反向代理功能，来将请求路由到对应的应用上。 前端微服务化。在不同的框架之上设计通讯、加载机制，以在一个页面内加载对应的应用。 微应用。通过软件工程的方式，在部署构建环境中，组合多个独立应用成一个单体应用。 微件化。开发一个新的构建系统，将部分业务功能构建成一个独立的 chunk 代码，使用时只需要远程加载即可。 前端容器化。通过将 iFrame 作为容器，来容纳其它前端应用。 应用组件化。借助于 Web Components 技术，来构建跨框架的前端应用。 ngx-planet 项目地址: https://github....</p></div><footer class=entry-footer><span title='2021-12-05 11:30:03 +0000 UTC'>December 5, 2021</span>&nbsp;·&nbsp;8 min&nbsp;·&nbsp;cui</footer><a class=entry-link aria-label="post link to 关于微前端实现原理与ngx-planet(一)" href=https://devcui.github.io/pokemon/posts/angular/ngxplanet1/></a></article><article class="post-entry tag-entry"><header class=entry-header><h2>关于微前端实现原理与ngx-planet(三)</h2></header><div class=entry-content><p>1.为什么要服务端渲染 因为公司后端服务在k8s上，是分布式的微服务，之前端全部打包部署在了物理机器(虚拟机)nginx上,如果通过helm做应用商店的话，nginx前端这部分无法处理，包括灰度部署，CI等，全部都只能做到接口级别的处理，并不能连带静态资源文件一起处理，所以基于分布式的前端整改迫在眉睫。
偶然发现了ngx-planet，整篇文章基于前几篇文章，可以看之前的几篇文章。
2.如何基于ngx-palnet进行服务端渲染 2.0 有路由前缀的情况下服务端渲染ngx-planet如何改进 在 start函数中监听路由阶段，其中的 startWith过滤路由要把 location.pathname修改好，要将前缀去除掉，至于如何动态去除不写死，仁者见仁智者见智。
2.1 首先，准备打包好的静态文件 将 build命令修改，注意 --deploy-url的意思是，打包完成后，静态资源路径是什么
1 "build": "ng build --prod --deploy-url=/static/star-universe/ --base-href=/star-universe", 打包后的index.html如图，静态资源路径变成了 /static/star-universe前缀，这里和 base-href不能冲突，否则在渲染时有死循环问题
其次 base-href就是项目访问路径前缀
然后修改 angular.json中的 build放到你的静态资源目录，这样在执行 npm run build后静态资源自动放入后台项目中的静态目录中
2.2 准备Portal后台项目 我的项目基于SpringBoot自动生成，项目结构如下
以下是用到的maven配置文件
1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 &lt;?...</p></div><footer class=entry-footer><span title='2021-12-05 11:30:03 +0000 UTC'>December 5, 2021</span>&nbsp;·&nbsp;2 min&nbsp;·&nbsp;cui</footer><a class=entry-link aria-label="post link to 关于微前端实现原理与ngx-planet(三)" href=https://devcui.github.io/pokemon/posts/angular/ngxplanet3/></a></article><article class="post-entry tag-entry"><header class=entry-header><h2>关于微前端实现原理与ngx-planet(二)</h2></header><div class=entry-content><p>道标 准备好源码，然后跟着文章去看代码，在每个代码块的第一行，我都把 filename 写上了，并且打开了 gitalk。
项目结构 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 - packages/planet |--src |--application |--planet-application-loader.spec.ts |--planet-application-loader.ts # 应用加载器 |--planet-application-ref.spec.ts |--planet-application-ref.ts # 应用的引用 |--planet-application.service.spec.ts |--planet-application.service.ts # 应用逻辑处理Service |--portal-application.spec.ts |--portal-application....</p></div><footer class=entry-footer><span title='2021-12-05 11:30:03 +0000 UTC'>December 5, 2021</span>&nbsp;·&nbsp;26 min&nbsp;·&nbsp;cui</footer><a class=entry-link aria-label="post link to 关于微前端实现原理与ngx-planet(二)" href=https://devcui.github.io/pokemon/posts/angular/ngxplanet2/></a></article><article class="post-entry tag-entry"><header class=entry-header><h2>关于微前端实现原理与ngx-planet(四)</h2></header><div class=entry-content><p>客制化 由于公司和公司的业务不同，所以在ngx-planet的基础上，需要作出一些针对于业务的拓展
目前分出四个基础项目
@yunzai/stars:封装了用户认证,元素权限,i18n等系统初始化信息的内容,需要发包的,意为繁星.
star-universe: portal项目,所有子前端项目的入口,意为宇宙.
star-dust:一些可能会通用的components都放到这个项目里,统一管理,意为星尘.
star-uranus:模版项目,意为天王星.
开发环境 可以看到桌面共有四个编辑器，开发时需要跑起其中三个项目. star-universe,star-dust,star-uranus
@yunzai/stars 因为是基础包，所以扩展了哪些功能点，先做一个介绍，因为发包，所以planet前缀都被我改名成为了star前缀，针对于ngx-planet加载过程请看前一篇link start。
接下来看项目结构
首先基于ngx-planet加入了auth,config,i18n,providers,stomp,token,user这些文件夹
module 针对于Module做出了以下改良 加入了TranslateModule来写i18n 加入了Inject的静态配置类StarConfig
1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 /* * @Author: ferried * @Email: harlancui@outlook....</p></div><footer class=entry-footer><span title='2021-12-05 11:30:03 +0000 UTC'>December 5, 2021</span>&nbsp;·&nbsp;3 min&nbsp;·&nbsp;cui</footer><a class=entry-link aria-label="post link to 关于微前端实现原理与ngx-planet(四)" href=https://devcui.github.io/pokemon/posts/angular/ngxplanet4/></a></article></main><footer class=footer><span>&copy; 2022 <a href=https://devcui.github.io/pokemon/>神奇宝贝大师的旅行日记</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>