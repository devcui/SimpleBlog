<!doctype html><html lang=cn dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>时序数据库 | 神奇宝贝大师的旅行日记</title><meta name=keywords content><meta name=description content="神奇宝贝大师的传奇之旅"><meta name=author content="cui"><link rel=canonical href=https://devcui.github.io/pokemon/categories/%E6%97%B6%E5%BA%8F%E6%95%B0%E6%8D%AE%E5%BA%93/><meta name=google-site-verification content="blog"><meta name=yandex-verification content="blog"><meta name=msvalidate.01 content="blog"><link crossorigin=anonymous href=/pokemon/assets/css/stylesheet.2068759a50238aee83375bc8cb602a1caff7316bea9cc81b83d90aeea0e276c5.css integrity="sha256-IGh1mlAjiu6DN1vIy2AqHK/3MWvqnMgbg9kK7qDidsU=" rel="preload stylesheet" as=style><link rel=icon href=https://devcui.github.io/pokemon/images/favicon.png><link rel=icon type=image/png sizes=16x16 href=https://devcui.github.io/pokemon/images/favicon.png><link rel=icon type=image/png sizes=32x32 href=https://devcui.github.io/pokemon/images/favicon.png><link rel=apple-touch-icon href=https://devcui.github.io/pokemon/images/favicon.png><link rel=mask-icon href=https://devcui.github.io/pokemon/images/favicon.png><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate type=application/rss+xml href=https://devcui.github.io/pokemon/categories/%E6%97%B6%E5%BA%8F%E6%95%B0%E6%8D%AE%E5%BA%93/index.xml><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script type=application/javascript>var doNotTrack=!1;doNotTrack||(function(e,t,n,s,o,i,a){e.GoogleAnalyticsObject=o,e[o]=e[o]||function(){(e[o].q=e[o].q||[]).push(arguments)},e[o].l=1*new Date,i=t.createElement(n),a=t.getElementsByTagName(n)[0],i.async=1,i.src=s,a.parentNode.insertBefore(i,a)}(window,document,"script","https://www.google-analytics.com/analytics.js","ga"),ga("create","UA-213464061-1","auto"),ga("send","pageview"))</script><meta property="og:title" content="时序数据库"><meta property="og:description" content="神奇宝贝大师的传奇之旅"><meta property="og:type" content="website"><meta property="og:url" content="https://devcui.github.io/pokemon/categories/%E6%97%B6%E5%BA%8F%E6%95%B0%E6%8D%AE%E5%BA%93/"><meta property="og:image" content="https://devcui.github.io/pokemon/images/head.png"><meta property="og:site_name" content="神奇宝贝大师的旅行日记"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://devcui.github.io/pokemon/images/head.png"><meta name=twitter:title content="时序数据库"><meta name=twitter:description content="神奇宝贝大师的传奇之旅"></head><body class=list id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://devcui.github.io/pokemon/ accesskey=h title="  (Alt + H)"><img src=https://devcui.github.io/pokemon/images/favicon.png alt aria-label=logo height=35></a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://devcui.github.io/pokemon/posts title=列表><span>列表</span></a></li><li><a href=https://devcui.github.io/pokemon/categories title=分类><span>分类</span></a></li><li><a href=https://devcui.github.io/pokemon/tags title=标签><span>标签</span></a></li><li><a href=https://devcui.github.io/pokemon/series title=系列><span>系列</span></a></li><li><a href=https://devcui.github.io/pokemon/archives title=归档><span>归档</span></a></li><li><a href=https://devcui.github.io/pokemon/about title=关于><span>关于</span></a></li><li><a href=https://devcui.github.io/pokemon/sponsor title=赞助><span>赞助</span></a></li><li><a href=https://zukan.pokemon.co.jp/ title=图鉴><span>图鉴</span>&nbsp;<svg fill="none" shape-rendering="geometricPrecision" stroke="currentcolor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" viewBox="0 0 24 24" height="12" width="12"><path d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6"/><path d="M15 3h6v6"/><path d="M10 14 21 3"/></svg></a></li></ul></nav></header><main class=main><header class=page-header><div class=breadcrumbs><a href=https://devcui.github.io/pokemon/>Home</a>&nbsp;»&nbsp;<a href=https://devcui.github.io/pokemon/categories/>Categories</a></div><h1>时序数据库</h1></header><article class="post-entry tag-entry"><header class=entry-header><h2>Prometheus Alerting</h2></header><div class=entry-content><p>1.Alerting with Prometheus is separated in to two parts 1-1Alerting rules Alerting rules is a file that formatted by yml,it’s define some exp in to the yaml file. Alerting rules is in Prometheus servers send alerts to an alert manager and alert manager managed those alerts. the rule document in there: the rules doc
1-2Alerting Manager AlertingManager is a command line tool and the command line tool flags has those functions...</p></div><footer class=entry-footer><span title='2021-12-05 11:30:03 +0000 UTC'>December 5, 2021</span>&nbsp;·&nbsp;3 min&nbsp;·&nbsp;cui</footer><a class=entry-link aria-label="post link to Prometheus Alerting" href=https://devcui.github.io/pokemon/posts/prometheus/prometheus-alerting/></a></article><article class="post-entry tag-entry"><header class=entry-header><h2>Prometheus Exporter</h2></header><div class=entry-content><p>time series metrics collect toolkit
提供了UI服务，默认端口30313
主要作用就是监控一下我们服务的各项指标，也有许多包已经集成了这个功能，基本上查找一下配置一下就可以快速的展示出各项指标了
业务指标 但例如 java_gc,go_gc,node_request_total这种指标对我们来说没有特别大的用处，我们的着力点应该在于提取业务指标，各个业务系统数据源不同逻辑不同导致无法使用通用型第三方包来构建我们的指标。
这个时候就出现了 prometheus-exporter用来放出自定义的业务指标，等待prometheus来此处收集。
prometheus exporter 其实很简单，就是攒一些prometheus数据格式的数据放入 /metrics路由中等待scrape就好
下面使用Go来举例子
这里使用了godror驱动oracle，prometheus/client_golang 客户端,logrus日志模块
一些命令行参数
main函数主要就是构造exporter对象然后启动http服务
exporter 结构体中加入了同步锁，封装好的oracle客户端比较重要的是 metricDescriptions和 metricMap这几个指标map
作为prometheus的exporter需要实现两个接口,一个是输入描述的 Describe一个是收集数据的 Collect
Collect，循环map然后将数据和字符串传入ch管道中
Describe相同都是向ch放入构建好的 指针类型对象
接下来看map中到底是什么
map为string对应的匿名函数,函数类型为MetricHandler
很好理解，将管道传入匿名函数，结构体传入匿名函数，然后利用结构体的oracleClient执行sql构建Metric结构体传入ch中即可
Over 整个流程非常简单，由于公司的exporter不可能开源，所以这里提供redis-exporter地址以供参考
https://github.com/oliver006/redis_exporter
2020结束，最后一篇简单的参考教程</p></div><footer class=entry-footer><span title='2021-12-05 11:30:03 +0000 UTC'>December 5, 2021</span>&nbsp;·&nbsp;1 min&nbsp;·&nbsp;cui</footer><a class=entry-link aria-label="post link to Prometheus Exporter" href=https://devcui.github.io/pokemon/posts/prometheus/prometheus-exporter/></a></article><article class="post-entry tag-entry"><header class=entry-header><h2>Prometheus Redis</h2></header><div class=entry-content><p>1.下载redis_exporter
2.脚本
1 nohup ./redis_exporter -redis.addr 0.0.0.0:6379 -redis.password "password" & link 3.promethus endpoint
1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 apiVersion: v1 kind: Endpoints metadata: name: redis-exporter subsets: - addresses: - ip: 222....</p></div><footer class=entry-footer><span title='2021-12-05 11:30:03 +0000 UTC'>December 5, 2021</span>&nbsp;·&nbsp;16 min&nbsp;·&nbsp;cui</footer><a class=entry-link aria-label="post link to Prometheus Redis" href=https://devcui.github.io/pokemon/posts/prometheus/prometheus-redis/></a></article><article class="post-entry tag-entry"><header class=entry-header><h2>Prometheus Rules</h2></header><div class=entry-content><p>1.Two types of rules Prometheus supports two types of rules .whitch may be configured and then evaluated at regular intervals: Recording rules and Alerting rules.
2.Recording rules 1.Recording rules allow you to precompute frequently needed or computationally expensive expressions and save their result as a new set of time series.
2.Be mutch faster than executing the origin expression every time it’s need.
3.Rules within a group run sequentially at a regular interval....</p></div><footer class=entry-footer><span title='2021-12-05 11:30:03 +0000 UTC'>December 5, 2021</span>&nbsp;·&nbsp;9 min&nbsp;·&nbsp;cui</footer><a class=entry-link aria-label="post link to Prometheus Rules" href=https://devcui.github.io/pokemon/posts/prometheus/prometheus-rules/></a></article></main><footer class=footer><span>&copy; 2022 <a href=https://devcui.github.io/pokemon/>神奇宝贝大师的旅行日记</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>